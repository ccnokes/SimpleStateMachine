<html>
<body>

<h3>Test page for SimpleStateMachine.</h3>
<p>Current state: <span id="state"></span></p>

<button class="state-btn" data-state="loading">Loading</button>
<button class="state-btn" data-state="loggedIn">Log in</button>
<button class="state-btn" data-state="loggedOut">Log out</button>

<script src="simple-state-machine.js"></script>
<script>

var sm = new SimpleStateMachine();

sm.subscribeToState(['*'], function(state) {
	document.getElementById('state').innerHTML = state.name;

	// var disabledStates = sm.allStateNames.filter(function(item){ 
	// 	return state.states.indexOf(item) === -1; 
	// });
	
	// disabledStates.forEach(function(name) {
	// 	document.querySelector('[data-state="'+name+'"]').disabled = true;
	// });
});

sm.setStates([
	{
		name: 'loading',
		initial: true,
		onEnter: function() { console.log('entered loading'); },
		onLeave: function() { console.log('left loading'); },
		states: [ '*' ]
	},
	{
		name: 'loggedIn',
		onEnter: function() { console.log('entered loggedIn'); },
		onLeave: function() { console.log('left loggedIn'); },
		states: [ 'loggedOut' ]
	},
	{
		name: 'loggedOut',
		onEnter: function() { console.log('entered loggedOut'); },
		onLeave: function() { console.log('left loggedOut'); },
		states: [ 'loggedIn' ]
	}
]);

//just for fun, log in after 500 ms
setTimeout(function() {
	sm.goToState('loggedIn');
}, 500);


function attachButtonEvents() {
	var buttons = document.getElementsByClassName('state-btn');
	[].slice.call(buttons).forEach(function(node, i) {
		node.addEventListener('click', function() {
			sm.goToState(node.dataset.state);
		});
	});
}

attachButtonEvents();

</script>
</body>
</html>