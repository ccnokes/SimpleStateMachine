/** 
* SimpleStateMachine 
* @version 1.0.1 
* @link https://github.com/ccnokes/SimpleStateMachine.git 
* @author Cameron Nokes 
* @license MIT 
*/ 
!function(a){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);this.SM=b,this.initial=a.initial||!1,this.visitedCount=0,this.active=a.initial?!0:!1}function c(a){return this instanceof c?(this.initialized=!1,this.subscribeQueue=[],a?this.setStates(a):this.states=[],this.history=[],void(this.currentState=null)):new c(a)}function d(a){var b={enterTime:new Date,stateName:a};this.history.push(b)}function e(a,b){var c=this;if(this.currentState&&this.currentState.deactivate(),d.call(this,a.name),this.currentState=a,this.currentState.activate(b),this.currentState.subscribers&&this.currentState.subscribers.length>0){var e=this.currentState.subscribers;e.forEach(function(a){a(c.currentState)})}}function f(a){var c=this;this.allStateNames=a.map(function(a){return a.name});var d=[];return a.forEach(function(a){a.possibleStates&&"*"!==a.possibleStates[0]||(a.possibleStates=c.allStateNames);var e=new b(a,c);d.push(e)}),d}b.addMethod=function(a,c){b.prototype[a]=c},b.prototype={activate:function(a){return this.active=!0,this.visitedCount++,this.onEnter&&this.onEnter(this,a),this},deactivate:function(){return this.active=!1,this.onLeave&&this.onLeave(this),this},isActive:function(){return this.active}},c.prototype={start:function(){if(this.initialized=!0,this.subscribeQueue&&this.subscribeQueue.length>0){var a=this;this.subscribeQueue.forEach(function(b){a.subscribeToState.apply(a,b)})}for(var b=0;b<this.states.length;b++){var c=this.states[b];c.initial&&e.call(this,c)}return this},setStates:function(a){return this.states=f.call(this,a),this},decorateStates:function(a,c){return b.addMethod(a,c),this},getCurrentState:function(){return this.currentState},isState:function(a){return this.getCurrentState().name===a},getPreviousState:function(){return this.history[this.history.length-2]?this.getState(this.history[this.history.length-2].stateName):null},getState:function(a){for(var b,c=0;c<this.states.length;c++)if(this.states[c].name===a){b=this.states[c];break}return b},getPossibleStates:function(){return this.currentState.possibleStates},getImpossibleStates:function(){var a=this.currentState.possibleStates;return this.allStateNames.filter(function(b){return-1===a.indexOf(b)})},nextState:function(a){var b=this.states.indexOf(this.currentState),c=b+1;c>=this.states.length&&(c=0),e.call(this,this.states[c],a)},goToState:function(a,b){if(this.currentState.possibleStates.indexOf(a)>-1){var c=this.getState(a);e.call(this,c,b)}},subscribeToState:function(a,b){if("string"==typeof a&&(a=[a]),this.initialized){var c=this,d=[];d="*"===a[0]?this.allStateNames:a,d.forEach(function(a){var d=c.getState(a);if(!d||"function"!=typeof b)throw new Error("can't subscribe to ",a);d.subscribers||(d.subscribers=[]),d.subscribers.push(b)})}else this.subscribeQueue.push([a,b]);return this}},"object"==typeof exports?exports=module.exports=c:a.SimpleStateMachine=c}(window);